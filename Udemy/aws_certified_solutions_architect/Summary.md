# Intro to Security Group

# Launching an Apache Server on EC2

# EC2 User Data

# EC2 Instance Launch Type
- On Demand : short workload, predictable pricing
- Reserved Instances: long worklogads
- Convertible Reserved Instances: 


# EC2 for Solutions Architects
- EC2 instances are billed by the second, t3.micro is free tier
- On Linux / Mac we use ssh, on Windows we use Putty
- SSH is on port 23, lock down the security group to your IP
- Know the 4 EC2 launch modes:  
    - On demand
    - Reserved
    - Spot instances
    - Dedicated hosts

# Scalability & High Availability 

# What is load balancing?
- Load balancers are servers that forward internet traffic to multiple serers downstream

- Application Load Balancer (v2)
    - Load balancing to multiple HTTP applications across machines (target group)
    - Load balancing to multiple applications on the same machine 
    - Load balancing based on route in URL
    - Load balancing based on hostnmae in URL

- Basically, they're awesome for micro services & container-based application
- Has a port mapping feature to redirect to a 
dynamic port

- ALB (v2) good to know
    - Stickiness can be enabled at the target group level
        - Same request goes to the same instance
        - Stickiness is directly generated by the ALB
    - ALB support HTTP/HTTPS & Websockets protocols
    -  The application servers don't see the IP of the client directly
        - The true IP of the client is inserted in the header X-Forwarded-For
        - We can also get Port and proto

- Network Load Balancer (v2)
    - Network load balancers (L4)
        - Forward TCP traffic to your instances
        - Handle millions of request per seconds
        - Support for static IP or elastic IP
        - Less latency ~ 100 ms (vs 400 ms for ALB)
    - Network load balancers are mostly used for extreme performance and should not be the default load balancer you choose


- LB : Good to Know
    - CLB and ALB support SSL sertificates and provide SSL termination
    - All load balacners have health check capability
    - ALB can route on based on hostname / path
    - ALB is a great fit with ECS
    - Any load balancer has a static host name. Do not resolve and use underlying ip


# Load Balancer Stickiness
- It is possible to implement stickiness so that the same client is always redirected to the same instance behind a load balancer
- This works for Classic Load Balancers & ALB
- The 'Cookie' used for stickiness has an expiration date you control
- Use case: make sure the user doesn't lose his session data
- Enabling stickiness may bring imblanace to the load over the backend EC2 instances
    - Target group's stickiness control


# Load Balancers for Solutions Architect
- Classic Load Balancers: questions on security groups, stickiness
- Application Load Balancer (Layer 7 of OSI)
    - Support routing based on hostname (users.example.com & payments.example.com)
    - Support routing based on path (example.com/users & example.com/payments)
    - Support redirects (from HTTP to HTTPS for example)
    - Support dynamic host port mapping with ECS
- NLB (Layer 4 of OSI) gets a static IP per AZ
    - Public facing: must attach Elastic IP - can help whitelist by clients
    - Private facing: will get random pricate IP based on free ones at time of creation
    - Has cross zone balancing
    - Has SSL termination (Jab 2019)

- Load Balancer Securit Groups
    - 80, 443 open for LB
    - only 80 open for the target instances

- LB - SSL Certificates
    - Users - LB : HTTPS(encrypted) over www
    - LB - EC2 instances : HTTP over private VPC
    - the LB uses an x.509 certificate (SSL/TLS server certificate)
    - You can manage certificates using ACM (AWS certificate Manager)
    - You can create and upload your own certificates alternatively
    - HTTPS listener:
        - you must specify a default certificate
        - You can add an optional list of certs to support multiple domains
        - clients can use SNI (Server Name Indication) to specify the hostname they reach
        - Ability to specify a security policy to support older versions of SSL / TLS (legacy clients) 

- Auto Scaling Groups Overview

- ASGs attributes
    - A launch configuration
        - AMI + instance type
        - EC2 User Data
        - EBS volumes
        - Security Groups
        - SSH key pair
    - Min size / max size/ initial capacity
    - network + subnets info
    - LB info
    - Scaling Policies

- Auto Scaling Alarms
    - it is possible to scale an ASG based on CloudWatch alamrs
    - Metrics are computed a metric (such as Average CPU)
    - Based on the alarm
        - We can create scale-out policies (increase the number of instances)
        - We can create scale-in policies (decrease the number of instances)

- Auto Scaling New Rules
    - It is now possible to define better auto scaling rules that are directly managed by EC2
        - Target Average CPU Usage
        - Number of reqeusts on the ELB per instance
        - Average Network In
        - Average Network Out
    - These rules are easier to set up and can make more sense

- Auto Scaling Custom Metric
    - We can auto scale based on a custom metric
    - 1. Send custom metric from application on EC2 to CloudWatch
    - 2. Create CloudWatch alarm to react to low / high values
    - 3. Use the CloudWatch alarm as the scaling policy for ASG


# ASG for Solutions Architects
- ASG Default Termination Policy
    - 1. Find the AZ which has the most number of instances
    - 2. 